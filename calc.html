<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>calc.lipl -- LIPL</title>
    <link href="style.css" rel="stylesheet" type="text/css" media="screen"/>
    <link href="print.css" rel="stylesheet" type="text/css" media="print"/>
</head>
<body>
<div id="wrap">
<div class="document" id="calc-lipl">
<h1 class="title">calc.lipl</h1>
<div class="syntax scheme">
<div class="highlight"><pre><span class="p">(</span><span class="nf">def</span> <span class="nv">parse</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">words</span> <span class="nv">x</span><span class="p">))</span>

<span class="p">(</span><span class="nf">def</span> <span class="nv">printStack</span> <span class="p">()</span>
    <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">((</span><span class="nf">compose</span> <span class="nv">println</span> <span class="nv">show</span><span class="p">)</span> <span class="nv">x</span><span class="p">))))</span>

<span class="p">(</span><span class="nf">def</span> <span class="nv">swapOp</span> <span class="p">(</span><span class="nf">st</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nb">length </span><span class="nv">st</span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">seq</span> <span class="p">(</span><span class="nf">println</span> <span class="s">&quot;not enough elements to swap&quot;</span><span class="p">)</span> <span class="nv">st</span><span class="p">)</span>
        <span class="p">(</span><span class="k">let </span><span class="err">{</span><span class="nv">a</span> <span class="nv">=</span> <span class="p">(</span><span class="nf">head</span> <span class="nv">st</span><span class="p">)</span><span class="o">,</span> <span class="nv">tl</span> <span class="nv">=</span> <span class="p">(</span><span class="nf">tail</span> <span class="nv">st</span><span class="p">)</span>
            <span class="o">,</span> <span class="nv">b</span> <span class="nv">=</span> <span class="p">(</span><span class="nf">head</span> <span class="nv">tl</span><span class="p">)</span><span class="o">,</span> <span class="nv">st</span><span class="o">&#39;</span> <span class="nv">=</span> <span class="p">(</span><span class="nf">tail</span> <span class="nv">tl</span><span class="p">)</span><span class="err">}</span>
            <span class="p">(</span><span class="nb">cons </span><span class="nv">b</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">a</span> <span class="nv">st</span><span class="o">&#39;</span><span class="p">)))))</span>

<span class="p">(</span><span class="nf">def</span> <span class="nv">dupOp</span> <span class="p">(</span><span class="nf">st</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">isEmpty</span> <span class="nv">st</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">seq</span> <span class="p">(</span><span class="nf">println</span> <span class="s">&quot;no element to dup&quot;</span><span class="p">)</span> <span class="err">[]</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">head</span> <span class="nv">st</span><span class="p">)</span> <span class="nv">st</span><span class="p">)))</span>

<span class="p">(</span><span class="nf">def</span> <span class="nv">popOp</span> <span class="p">(</span><span class="nf">st</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">isEmpty</span> <span class="nv">st</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">seq</span> <span class="p">(</span><span class="nf">println</span> <span class="s">&quot;no element to pop&quot;</span><span class="p">)</span> <span class="err">[]</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">tail</span> <span class="nv">st</span><span class="p">)))</span>

<span class="p">(</span><span class="nf">def</span> <span class="nv">arithOp</span> <span class="p">(</span><span class="nf">op</span> <span class="nv">st</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&lt; </span><span class="p">(</span><span class="nb">length </span><span class="nv">st</span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">seq</span> <span class="p">(</span><span class="nf">println</span> <span class="s">&quot;don&#39;t have 2 elements for arithmetic&quot;</span><span class="p">)</span> <span class="nv">st</span><span class="p">)</span>
        <span class="p">(</span><span class="k">let </span><span class="err">{</span><span class="nv">tl</span> <span class="nv">=</span> <span class="p">(</span><span class="nf">tail</span> <span class="nv">st</span><span class="p">)</span><span class="o">,</span> <span class="nv">st</span><span class="o">&#39;</span> <span class="nv">=</span> <span class="p">(</span><span class="nf">tail</span> <span class="nv">tl</span><span class="p">)</span>
            <span class="o">,</span> <span class="nv">arg1</span> <span class="nv">=</span> <span class="p">(</span><span class="nf">head</span> <span class="nv">tl</span><span class="p">)</span><span class="o">,</span> <span class="nv">arg2</span> <span class="nv">=</span> <span class="p">(</span><span class="nf">head</span> <span class="nv">st</span><span class="p">)</span><span class="err">}</span>
            <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">op</span> <span class="nv">arg1</span> <span class="nv">arg2</span><span class="p">)</span> <span class="nv">st</span><span class="o">&#39;</span><span class="p">))))</span>
<span class="p">(</span><span class="nf">def</span> <span class="nv">clearOp</span> <span class="p">(</span><span class="nf">st</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">isEmpty</span> <span class="nv">st</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">seq</span> <span class="p">(</span><span class="nf">println</span> <span class="s">&quot;nothing to clear&quot;</span><span class="p">)</span> <span class="err">[]</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">seq</span> <span class="p">(</span><span class="nf">printStack</span> <span class="nv">st</span><span class="p">)</span> <span class="err">[]</span><span class="p">)))</span>

<span class="p">(</span><span class="nf">def</span> <span class="nv">isInt</span> <span class="p">(</span><span class="nf">s</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">isEmpty</span> <span class="nv">s</span><span class="p">)</span>
        <span class="nv">False</span>
        <span class="p">(</span><span class="nf">all</span> <span class="nv">isNum</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">==</span> <span class="ss">&#39;-</span><span class="o">&#39;</span> <span class="p">(</span><span class="nf">head</span> <span class="nv">s</span><span class="p">))</span> <span class="p">(</span><span class="nf">tail</span> <span class="nv">s</span><span class="p">)</span> <span class="nv">s</span><span class="p">))))</span>

<span class="p">(</span><span class="nf">def</span> <span class="nv">eval</span> <span class="p">(</span><span class="nf">st</span> <span class="nv">l</span><span class="p">)</span> <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">isEmpty</span> <span class="nv">l</span><span class="p">)</span>
    <span class="nv">st</span>
    <span class="p">(</span><span class="k">let </span><span class="err">{</span><span class="nv">x</span> <span class="nv">=</span> <span class="p">(</span><span class="nf">head</span> <span class="nv">l</span><span class="p">)</span><span class="o">,</span> <span class="nv">xs</span> <span class="nv">=</span> <span class="p">(</span><span class="nf">tail</span> <span class="nv">l</span><span class="p">)</span><span class="err">}</span>
        <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">==</span> <span class="s">&quot;-&quot;</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">eval </span><span class="p">(</span><span class="nf">arithOp</span> <span class="nv">-</span> <span class="nv">st</span><span class="p">)</span> <span class="nv">xs</span><span class="p">)</span>
        <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">==</span> <span class="s">&quot;+&quot;</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">eval </span><span class="p">(</span><span class="nf">arithOp</span> <span class="nv">+</span> <span class="nv">st</span><span class="p">)</span> <span class="nv">xs</span><span class="p">)</span>
        <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">==</span> <span class="s">&quot;*&quot;</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">eval </span><span class="p">(</span><span class="nf">arithOp</span> <span class="nv">*</span> <span class="nv">st</span><span class="p">)</span> <span class="nv">xs</span><span class="p">)</span>
        <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">==</span> <span class="s">&quot;/&quot;</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">eval </span><span class="p">(</span><span class="nf">arithOp</span> <span class="nv">div</span> <span class="nv">st</span><span class="p">)</span> <span class="nv">xs</span><span class="p">)</span>
        <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">==</span> <span class="s">&quot;swap&quot;</span> <span class="nv">x</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">eval </span><span class="p">(</span><span class="nf">swapOp</span> <span class="nv">st</span><span class="p">)</span> <span class="nv">xs</span><span class="p">)</span>
        <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">==</span> <span class="s">&quot;dup&quot;</span> <span class="nv">x</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">eval </span><span class="p">(</span><span class="nf">dupOp</span> <span class="nv">st</span><span class="p">)</span> <span class="nv">xs</span><span class="p">)</span>
        <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">==</span> <span class="s">&quot;pop&quot;</span> <span class="nv">x</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">eval </span><span class="p">(</span><span class="nf">popOp</span> <span class="nv">st</span><span class="p">)</span> <span class="nv">xs</span><span class="p">)</span>
        <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">==</span> <span class="s">&quot;.&quot;</span> <span class="nv">x</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">eval </span><span class="p">(</span><span class="nf">clearOp</span> <span class="nv">st</span><span class="p">)</span> <span class="nv">xs</span><span class="p">)</span>
        <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">isInt</span> <span class="nv">x</span><span class="p">)</span>
            <span class="p">(</span><span class="nb">eval </span><span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">readInt</span> <span class="nv">x</span><span class="p">)</span> <span class="nv">st</span><span class="p">)</span> <span class="nv">xs</span><span class="p">)</span>
            <span class="p">(</span><span class="nf">seq</span> <span class="p">(</span><span class="nf">println</span> <span class="p">(</span><span class="nf">concat</span> <span class="s">&quot;not integer: &quot;</span> <span class="nv">x</span><span class="p">))</span> <span class="nv">st</span><span class="p">)))))))))))))</span>

<span class="p">(</span><span class="nf">def</span> <span class="nv">prompt</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">seq</span> <span class="p">(</span><span class="nf">print</span> <span class="nv">x</span><span class="p">)</span> <span class="nv">getLine</span><span class="p">))</span>

<span class="p">(</span><span class="nf">def</span> <span class="nv">repl</span> <span class="p">(</span><span class="nf">st</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let </span><span class="err">{</span> <span class="nv">input</span> <span class="nv">=</span> <span class="p">(</span><span class="nf">prompt</span> <span class="s">&quot;CALC&gt; &quot;</span><span class="p">)</span> <span class="err">}</span>
        <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">==</span> <span class="s">&quot;:q&quot;</span> <span class="nv">input</span><span class="p">)</span>
            <span class="p">()</span>
        <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">==</span> <span class="s">&quot;:s&quot;</span> <span class="nv">input</span><span class="p">)</span>
            <span class="p">(</span><span class="nf">seq</span> <span class="p">(</span><span class="nf">printStack</span> <span class="nv">st</span><span class="p">)</span> <span class="p">(</span><span class="nf">repl</span> <span class="nv">st</span><span class="p">))</span>
            <span class="p">(</span><span class="nf">repl</span> <span class="p">(</span><span class="nb">eval </span><span class="nv">st</span> <span class="p">(</span><span class="nf">parse</span> <span class="nv">input</span><span class="p">)))))))</span>

<span class="p">(</span><span class="nf">def</span> <span class="nv">msg</span> <span class="p">()</span>
    <span class="s">&quot;</span>
<span class="s">Welcome to Stack Based Postfix Calculator</span>
<span class="s">- :q        quits</span>
<span class="s">- :s        shows stack content</span>
<span class="s">- .         clears stack</span>
<span class="s">- swap      swaps top 2 elements from the stack</span>
<span class="s">- dup       duplicates top element from the stack</span>
<span class="s">- pop       pops top element from the stack</span>
<span class="s">- only calculates postfix arithmetic expressions</span>
<span class="s">  involving Integers, +, -, *, /&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="nf">def</span> <span class="nv">main</span> <span class="p">()</span>
    <span class="p">(</span><span class="nf">seq</span>
        <span class="p">(</span><span class="nf">println</span> <span class="nv">msg</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">repl</span> <span class="err">[]</span><span class="p">)))</span>

<span class="p">(</span><span class="nf">main</span><span class="p">)</span>
</pre></div>

</div>
</div>

</div>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-31053646-3']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

</body>
</html>
